title: Economic Health Calculator
view-if: 0
on-arrival: {!
var SYSTEMIC_CRISIS_YEAR_THRESHOLD = 1978;
var FOREX_THRESHOLD_LOW = 40;
var FOREX_THRESHOLD_MID = 60;
var FOREX_THRESHOLD_HIGH = 80;
var FOREX_DISABLE_THRESHOLD = 70;

// Recalculate economic values from base + modifier to ensure modifiers are applied
Q.inflation = (Q.base_inflation || 0) + (Q.inflation_modifier || 0);
Q.economic_growth = (Q.base_growth || 0) + (Q.growth_modifier || 0);
Q.unemployed = (Q.base_unemployment || 0) + (Q.unemployment_modifier || 0);

// Calculate Economic Health based on Inflation, Unemployment, and GDP Growth

// Calculate Inflation Score
if (Q.inflation >= 0 && Q.inflation <= 10) {
    Q.inflation_score = 1;
} else if (Q.inflation > 10 && Q.inflation <= 20) {
    Q.inflation_score = 0;
} else if (Q.inflation > 20 && Q.inflation <= 30) {
    Q.inflation_score = -1;
} else if (Q.inflation > 30 && Q.inflation <= 40) {
    Q.inflation_score = -2;
} else if (Q.inflation > 40 && Q.inflation <= 60) {
    Q.inflation_score = -4;
} else if (Q.inflation > 60) {
    Q.inflation_score = -6;
}

// Calculate Unemployment Score
if (Q.unemployed >= 0 && Q.unemployed <= 3) {
    Q.unemployment_score = 1;
} else if (Q.unemployed > 3 && Q.unemployed <= 6) {
    Q.unemployment_score = 0;
} else if (Q.unemployed > 6 && Q.unemployed <= 10) {
    Q.unemployment_score = -1;
} else if (Q.unemployed > 10 && Q.unemployed <= 15) {
    Q.unemployment_score = -2;
} else if (Q.unemployed > 15 && Q.unemployed <= 20) {
    Q.unemployment_score = -3;
} else if (Q.unemployed > 20) {
    Q.unemployment_score = -5;
}

// Calculate GDP Growth Score
if (Q.economic_growth < 0) {
    Q.growth_score = -5;
} else if (Q.economic_growth >= 0 && Q.economic_growth <= 2) {
    Q.growth_score = -2;
} else if (Q.economic_growth > 2 && Q.economic_growth <= 4) {
    Q.growth_score = -1;
} else if (Q.economic_growth > 4 && Q.economic_growth <= 6) {
    Q.growth_score = 0;
} else if (Q.economic_growth > 6 && Q.economic_growth <= 8) {
    Q.growth_score = 1;
} else if (Q.economic_growth > 8) {
    Q.growth_score = 2;
}

// Calculate raw Economic Health (before forex pressure adjustment)
Q.economy_health_raw = Q.inflation_score + Q.unemployment_score + Q.growth_score;

// Calculate Forex Multiplier based on forex pressure
if (Q.forex_pressure < FOREX_THRESHOLD_LOW) {
    Q.forex_multiplier = 1.0;
} else if (Q.forex_pressure >= FOREX_THRESHOLD_LOW && Q.forex_pressure < FOREX_THRESHOLD_MID) {
    Q.forex_multiplier = 0.6;
} else if (Q.forex_pressure >= FOREX_THRESHOLD_MID && Q.forex_pressure < FOREX_THRESHOLD_HIGH) {
    Q.forex_multiplier = 0.35;
} else if (Q.forex_pressure >= FOREX_THRESHOLD_HIGH) {
    Q.forex_multiplier = 0.1;
    Q.crisis_forex_flag = 1;
}

// Apply forex multiplier asymmetrically
if (Q.economy_health_raw >= 0) {
    Q.economy_health = Math.round(Q.economy_health_raw * Q.forex_multiplier);
} else {
    Q.economy_health = Math.round(Q.economy_health_raw / Q.forex_multiplier);
}

// Set health status text for display
if (Q.economy_health > 3) {
    Q.health_economy_status = "Booming";
} else if (Q.economy_health >= 0 && Q.economy_health <= 3) {
    Q.health_economy_status = "Stable";
} else if (Q.economy_health >= -5 && Q.economy_health < 0) {
    Q.health_economy_status = "Unhealthy";
} else if (Q.economy_health < -5) {
    Q.health_economy_status = "In Crisis";
}

// Hard threshold effects
Q.industrial_cards_disabled = (Q.forex_pressure > FOREX_DISABLE_THRESHOLD) ? 1 : 0;
if (Q.economy_health < -7) {
    Q.strike_unrest_risk = 1;
} else {
    Q.strike_unrest_risk = 0;
}
if (Q.economy_health < -10 && Q.year >= SYSTEMIC_CRISIS_YEAR_THRESHOLD) {
    Q.systemic_crisis_mode = 1;
} else if (Q.systemic_crisis_mode && Q.economy_health >= -10) {
    Q.systemic_crisis_mode = 0;
}

// Apply economic effects each turn when flag is set
// Effects are scaled per turn to gradually accumulate over time
if (Q.apply_economy_effects == 1) {
    
    if (Q.economy_health > 3) {
        // Booming Economy: +0.83% per turn all demographics, +1.67% capitalists (percentages rounded)
        // (equivalent to +5% and +10% over 6 turns / 3 months)
        if (Q.CHP_in_government) {
            Q.rural_chp += 0.833333;
            Q.workers_chp += 0.833333;
            Q.petty_bourgeoisie_chp += 0.833333;
            Q.state_employees_chp += 0.833333;
            Q.capitalists_chp += 1.666667;
            Q.alevis_chp += 0.833333;
            Q.kurds_chp += 0.833333;
        } else if (Q.z_in_government) {
            Q.rural_z += 0.833333;
            Q.workers_z += 0.833333;
            Q.petty_bourgeoisie_z += 0.833333;
            Q.state_employees_z += 0.833333;
            Q.capitalists_z += 1.666667;
            Q.alevis_z += 0.833333;
            Q.kurds_z += 0.833333;
        } else if (Q.DP_in_government) {
            Q.rural_DP += 0.833333;
            Q.workers_DP += 0.833333;
            Q.petty_bourgeoisie_DP += 0.833333;
            Q.state_employees_DP += 0.833333;
            Q.capitalists_DP += 1.666667;
            Q.alevis_DP += 0.833333;
            Q.kurds_DP += 0.833333;
        }
    } else if (Q.economy_health >= -5 && Q.economy_health < 0) {
        // Unhealthy Economy: -0.33% per turn all demographics (percentage rounded)
        // (equivalent to -2% over 6 turns / 3 months)
        if (Q.CHP_in_government) {
            Q.rural_chp -= 0.333333;
            Q.workers_chp -= 0.333333;
            Q.petty_bourgeoisie_chp -= 0.333333;
            Q.state_employees_chp -= 0.333333;
            Q.capitalists_chp -= 0.333333;
            Q.alevis_chp -= 0.333333;
            Q.kurds_chp -= 0.333333;
        } else if (Q.z_in_government) {
            Q.rural_z -= 0.333333;
            Q.workers_z -= 0.333333;
            Q.petty_bourgeoisie_z -= 0.333333;
            Q.state_employees_z -= 0.333333;
            Q.capitalists_z -= 0.333333;
            Q.alevis_z -= 0.333333;
            Q.kurds_z -= 0.333333;
        } else if (Q.DP_in_government) {
            Q.rural_DP -= 0.333333;
            Q.workers_DP -= 0.333333;
            Q.petty_bourgeoisie_DP -= 0.333333;
            Q.state_employees_DP -= 0.333333;
            Q.capitalists_DP -= 0.333333;
            Q.alevis_DP -= 0.333333;
            Q.kurds_DP -= 0.333333;
        }
    } else if (Q.economy_health < -5) {
        // Crisis Economy: -0.67% per turn all demographics (percentage rounded)
        // (equivalent to -4% over 6 turns / 3 months)
        if (Q.CHP_in_government) {
            Q.rural_chp -= 0.666667;
            Q.workers_chp -= 0.666667;
            Q.petty_bourgeoisie_chp -= 0.666667;
            Q.state_employees_chp -= 0.666667;
            Q.capitalists_chp -= 0.666667;
            Q.alevis_chp -= 0.666667;
            Q.kurds_chp -= 0.666667;
        } else if (Q.z_in_government) {
            Q.rural_z -= 0.666667;
            Q.workers_z -= 0.666667;
            Q.petty_bourgeoisie_z -= 0.666667;
            Q.state_employees_z -= 0.666667;
            Q.capitalists_z -= 0.666667;
            Q.alevis_z -= 0.666667;
            Q.kurds_z -= 0.666667;
        } else if (Q.DP_in_government) {
            Q.rural_DP -= 0.666667;
            Q.workers_DP -= 0.666667;
            Q.petty_bourgeoisie_DP -= 0.666667;
            Q.state_employees_DP -= 0.666667;
            Q.capitalists_DP -= 0.666667;
            Q.alevis_DP -= 0.666667;
            Q.kurds_DP -= 0.666667;
        }
    }
}
!}
go-to: post_event.events_choice if has_event = 1; main if has_event = 0 and difficulty >= 0; main.main_easy if has_event = 0 and difficulty < 0
